<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æä¹å»æ°´å°å·¥å…· - åç«¯ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .badge {
            display: inline-block;
            background: #4caf50;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            margin-top: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            font-weight: 600;
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
        }

        input[type="text"] {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .video-container {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
        }

        .video-container.show {
            display: block;
        }

        .video-player {
            width: 100%;
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            background: #000;
        }

        .video-info {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
        }

        .video-info h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .video-info p {
            color: #666;
            margin: 5px 0;
        }

        .download-btn {
            margin-top: 15px;
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .message {
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        .message.show {
            display: block;
        }

        .message.error {
            background: #fee;
            color: #c33;
        }

        .message.success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }

        .info-box h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .info-box ul {
            margin-left: 20px;
            color: #555;
        }

        .info-box li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¬ æä¹å»æ°´å°å·¥å…·</h1>
            <p>æ”¯æŒæŠ–éŸ³ã€TikTokã€å¿«æ‰‹ã€Bç«™è§†é¢‘æ— æ°´å°ä¸‹è½½</p>
            <span class="badge">âœ“ å…¨å¹³å°æ”¯æŒ</span>
        </div>

        <div class="input-group">
            <label for="videoUrl">è§†é¢‘é“¾æ¥</label>
            <div class="input-wrapper">
                <input type="text" id="videoUrl" placeholder="ç²˜è´´æŠ–éŸ³/TikTok/å¿«æ‰‹/Bç«™åˆ†äº«é“¾æ¥..." />
                <button class="btn btn-primary" onclick="parseVideo()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    è§£æè§†é¢‘
                </button>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p style="margin-top: 15px; color: #666;">æ­£åœ¨è§£æä¸­...</p>
        </div>

        <div class="message" id="message"></div>

        <div class="video-container" id="videoContainer">
            <video id="videoPlayer" class="video-player" controls>
                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
            </video>
            <div class="video-info">
                <h3 id="videoTitle">è§†é¢‘æ ‡é¢˜</h3>
                <p id="videoAuthor">ä½œè€…ï¼šåŠ è½½ä¸­...</p>
                <button class="download-btn" onclick="downloadVideo()">
                    ğŸ’¾ ä¸‹è½½æ— æ°´å°è§†é¢‘
                </button>
            </div>
        </div>

        <div class="info-box">
            <h3>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3>
            <ul>
                <li>æ”¯æŒå¹³å°ï¼šæŠ–éŸ³ã€TikTokã€å¿«æ‰‹ã€Bç«™</li>
                <li>å¤åˆ¶è§†é¢‘åˆ†äº«é“¾æ¥ï¼ˆåŒ…å«æ–‡å­—ä¹Ÿå¯ä»¥ï¼‰</li>
                <li>ç²˜è´´åˆ°è¾“å…¥æ¡†ï¼Œç‚¹å‡»"è§£æè§†é¢‘"</li>
                <li>ç­‰å¾…è§£æå®Œæˆï¼Œå³å¯åœ¨çº¿è§‚çœ‹æˆ–ä¸‹è½½</li>
                <li>æ”¯æŒçŸ­é“¾æ¥å’Œå®Œæ•´é“¾æ¥</li>
            </ul>
        </div>

        <div class="info-box" style="background: #e8f5e9; border-color: #4caf50;">
            <h3>âœ¨ åç«¯æœåŠ¡ä¼˜åŠ¿</h3>
            <ul>
                <li><strong>æ— CORSé™åˆ¶ï¼š</strong>åç«¯ç›´æ¥è¯·æ±‚ï¼Œä¸å—æµè§ˆå™¨é™åˆ¶</li>
                <li><strong>æ›´é«˜æˆåŠŸç‡ï¼š</strong>å¤šAPIå¤‡ç”¨æ–¹æ¡ˆï¼Œç¡®ä¿è§£ææˆåŠŸ</li>
                <li><strong>ç¨³å®šå¯é ï¼š</strong>æœåŠ¡ç«¯å¤„ç†ï¼Œæ€§èƒ½æ›´å¥½</li>
                <li><strong>æ”¯æŒSealosï¼š</strong>ä¸€é”®éƒ¨ç½²åˆ°äº‘ç«¯</li>
            </ul>
        </div>
    </div>

    <script>
        let currentVideoData = null;

        async function parseVideo() {
            const videoUrl = document.getElementById('videoUrl').value.trim();
            const loading = document.getElementById('loading');
            const message = document.getElementById('message');
            const videoContainer = document.getElementById('videoContainer');

            // æ¸…é™¤ä¹‹å‰çš„çŠ¶æ€
            message.classList.remove('show');
            videoContainer.classList.remove('show');

            if (!videoUrl) {
                showMessage('è¯·è¾“å…¥è§†é¢‘é“¾æ¥ï¼', 'error');
                return;
            }

            loading.classList.add('show');

            try {
                const response = await fetch('/api/parse', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url: videoUrl })
                });

                const data = await response.json();
                loading.classList.remove('show');

                if (response.ok && data.success) {
                    currentVideoData = data;
                    displayVideo(data);
                    showMessage('è§£ææˆåŠŸï¼', 'success');
                } else {
                    showMessage(data.error || 'è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥é“¾æ¥æ˜¯å¦æ­£ç¡®', 'error');
                }
            } catch (error) {
                loading.classList.remove('show');
                showMessage('ç½‘ç»œé”™è¯¯ï¼š' + error.message, 'error');
                console.error('Error:', error);
            }
        }

        function displayVideo(data) {
            const videoContainer = document.getElementById('videoContainer');
            const videoPlayer = document.getElementById('videoPlayer');
            const videoTitle = document.getElementById('videoTitle');
            const videoAuthor = document.getElementById('videoAuthor');

            videoPlayer.src = data.videoUrl;
            videoPlayer.poster = data.thumbnail || '';
            videoTitle.textContent = data.title;
            videoAuthor.textContent = `ä½œè€…ï¼š${data.author}`;

            videoContainer.classList.add('show');
            videoContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function downloadVideo() {
            if (!currentVideoData) {
                showMessage('è¯·å…ˆè§£æè§†é¢‘', 'error');
                return;
            }

            const a = document.createElement('a');
            a.href = currentVideoData.videoUrl;
            a.download = currentVideoData.title + '.mp4';
            a.target = '_blank';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            showMessage('ä¸‹è½½å·²å¼€å§‹ï¼', 'success');
        }

        function showMessage(text, type) {
            const message = document.getElementById('message');
            message.textContent = text;
            message.className = 'message show ' + type;
            setTimeout(() => {
                message.classList.remove('show');
            }, 5000);
        }

        // å›è½¦é”®æäº¤
        document.getElementById('videoUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                parseVideo();
            }
        });
    </script>
</body>
</html>
